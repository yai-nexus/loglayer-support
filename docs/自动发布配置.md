# NPM 自动发布配置

本项目已配置了自动发布到 NPM 的 GitHub Actions 工作流。

## 前置要求

### 1. 配置 NPM Token

1. 登录 [npmjs.com](https://www.npmjs.com/)
2. 进入 Account Settings > Access Tokens
3. 创建一个 Automation token
4. 在 GitHub 仓库中添加 Secret：
   - 名称：`NPM_TOKEN`
   - 值：刚才创建的 token

### 2. 确保包名和权限正确

- 包名：`@yai-nexus/loglayer-support`
- 确保你有发布权限到 `@yai-nexus` 组织

## 发布方式

### 1. 自动发布（推荐）

通过创建 GitHub Release 触发：

1. 运行版本更新工作流：
   - 进入 GitHub Actions 页面
   - 选择 "版本自动更新" 工作流
   - 点击 "Run workflow"
   - 选择版本类型（patch/minor/major/prerelease）
   
2. 系统会自动：
   - 更新 package.json 版本号
   - 创建 git tag
   - 创建 GitHub Release
   - 触发 NPM 发布

### 2. 手动发布

也可以手动触发发布：

1. 进入 GitHub Actions 页面
2. 选择 "发布到 NPM" 工作流
3. 点击 "Run workflow"
4. 选择发布标签（latest 或 beta）

## 工作流说明

### CI 工作流 (ci.yml)
- 在每次 push 和 PR 时运行
- 测试多个 Node.js 版本（16, 18, 20）
- 执行代码检查、类型检查、构建和测试

### 发布工作流 (publish.yml)
- 在创建 Release 时自动触发
- 可手动触发选择发布标签
- 执行完整的检查和构建流程
- 发布到 NPM

### 版本更新工作流 (version-bump.yml)
- 手动触发，用于更新版本号
- 自动创建 git tag 和 GitHub Release
- 支持 patch, minor, major, prerelease 版本类型

## 本地发布（备用）

如果需要本地发布：

```bash
# 确保代码质量
npm run lint
npm run format:check
npm run type-check
npm run build

# 发布到 latest
npm publish

# 发布到 beta
npm publish --tag beta
```

## 版本管理建议

- **patch**：bug 修复（0.4.0 → 0.4.1）
- **minor**：新功能，向后兼容（0.4.0 → 0.5.0）
- **major**：破坏性更改（0.4.0 → 1.0.0）
- **prerelease**：预发布版本（0.4.0 → 0.4.1-0）

## 注意事项

1. 发布前确保所有测试通过
2. 更新 CHANGELOG.md 记录变更
3. 确保 package.json 中的 files 字段包含所有必要文件
4. 发布后检查 NPM 包页面确认发布成功