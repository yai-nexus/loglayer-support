# Pino Bridge Transport å®æ–½è®¡åˆ’

**åˆ†æ”¯**: `feature/pino-bridge-sls-transport`  
**åŸºäºç‰ˆæœ¬**: `v0.7.0-beta.2`  
**ç›®æ ‡**: å®æ–½ CTO æå‡ºçš„ Pino Bridge Transport æ–¹æ¡ˆ  

---

## ğŸ¯ å®æ–½ç›®æ ‡

åŸºäº CTO çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œå®ç°ä¸€ä¸ªå®Œå…¨å…¼å®¹ Next.js çš„ SLS æ—¥å¿—ä¼ è¾“è§£å†³æ–¹æ¡ˆï¼š

```
LogLayer â†’ PinoBridgeTransport â†’ Pino Core â†’ Worker Thread â†’ @wddv/pino-aliyun-sls â†’ SLS
```

## ğŸ“‹ å®æ–½æ­¥éª¤

### Phase 1: ä¾èµ–éªŒè¯å’Œå®‰è£… (é¢„è®¡ 0.5 å¤©)
- [ ] éªŒè¯ `@wddv/pino-aliyun-sls` åŒ…çš„å¯ç”¨æ€§å’Œå…¼å®¹æ€§
- [ ] å®‰è£…å¿…è¦çš„ä¾èµ–åŒ…
- [ ] åˆ›å»ºåŸºç¡€çš„æµ‹è¯•ç¯å¢ƒ

### Phase 2: æ ¸å¿ƒç»„ä»¶å¼€å‘ (é¢„è®¡ 1 å¤©)
- [ ] åˆ›å»º `lib/pino-sls-instance.ts` - Pino SLS Transport é…ç½®
- [ ] åˆ›å»º `transports/pino-bridge-transport.ts` - LogLayer æ¡¥æ¥å™¨
- [ ] å®ç°ç¯å¢ƒå˜é‡é…ç½®å’ŒéªŒè¯é€»è¾‘

### Phase 3: é›†æˆå’Œé…ç½® (é¢„è®¡ 0.5 å¤©)
- [ ] ä¿®æ”¹ `examples/nextjs-example/lib/server-logger.ts`
- [ ] æ·»åŠ æ–°çš„ Transport åˆ° LogLayer é…ç½®
- [ ] é…ç½®ç¯å¢ƒå˜é‡å’Œå¯ç”¨æ¡ä»¶

### Phase 4: æµ‹è¯•éªŒè¯ (é¢„è®¡ 1 å¤©)
- [ ] å•å…ƒæµ‹è¯•ï¼šéªŒè¯å„ç»„ä»¶åŠŸèƒ½
- [ ] é›†æˆæµ‹è¯•ï¼šéªŒè¯ Next.js ç¯å¢ƒå…¼å®¹æ€§
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•ï¼šéªŒè¯ SLS æ—¥å¿—ä¼ è¾“
- [ ] æ€§èƒ½æµ‹è¯•ï¼šéªŒè¯ Worker Thread æ€§èƒ½

### Phase 5: æ–‡æ¡£å’Œå‘å¸ƒ (é¢„è®¡ 0.5 å¤©)
- [ ] æ›´æ–°ä½¿ç”¨æ–‡æ¡£
- [ ] åˆ›å»ºè¿ç§»æŒ‡å—
- [ ] å‡†å¤‡å‘å¸ƒè¯´æ˜

## ğŸ”§ æŠ€æœ¯è¦ç‚¹

### å…³é”®ä¾èµ–
```json
{
  "@wddv/pino-aliyun-sls": "^x.x.x",
  "pino": "^8.x.x"
}
```

### æ ¸å¿ƒæ–‡ä»¶ç»“æ„
```
packages/server/src/
â”œâ”€â”€ transports/
â”‚   â””â”€â”€ pino-bridge-transport.ts    # æ–°å¢
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ pino-sls-instance.ts        # æ–°å¢
â””â”€â”€ server-transport.ts             # å¯èƒ½éœ€è¦è°ƒæ•´

examples/nextjs-example/lib/
â””â”€â”€ server-logger.ts                # éœ€è¦ä¿®æ”¹
```

### ç¯å¢ƒå˜é‡
```bash
# å¿…éœ€çš„ SLS é…ç½®
SLS_ACCESS_KEY_ID=xxx
SLS_ACCESS_KEY_SECRET=xxx
SLS_ENDPOINT=xxx
SLS_PROJECT=xxx
SLS_LOGSTORE=xxx

# å¯é€‰é…ç½®
LOG_LEVEL=info
NODE_ENV=production
```

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- [ ] Next.js åº”ç”¨å¯ä»¥æˆåŠŸå‘é€æ—¥å¿—åˆ° SLS
- [ ] ä¸å†å‡ºç° `createRequire is not a function` é”™è¯¯
- [ ] ç¯å¢ƒå˜é‡ç¼ºå¤±æ—¶ä¼˜é›…é™çº§
- [ ] Worker Thread ç¨³å®šè¿è¡Œï¼Œæ— å†…å­˜æ³„æ¼

### æ€§èƒ½éªŒæ”¶
- [ ] æ—¥å¿—å‘é€å»¶è¿Ÿ < 100ms (P95)
- [ ] å†…å­˜ä½¿ç”¨å¢é•¿ < 10MB
- [ ] CPU ä½¿ç”¨ç‡å¢é•¿ < 5%

### å…¼å®¹æ€§éªŒæ”¶
- [ ] Next.js å¼€å‘ç¯å¢ƒæ­£å¸¸å·¥ä½œ
- [ ] Next.js ç”Ÿäº§ç¯å¢ƒæ­£å¸¸å·¥ä½œ
- [ ] ç°æœ‰ LogLayer API å®Œå…¨å…¼å®¹
- [ ] å¯ä»¥ä¸å…¶ä»– Transport å…±å­˜

## ğŸš¨ é£é™©æ§åˆ¶

### æŠ€æœ¯é£é™©
- **ä¾èµ–åŒ…é£é™©**: `@wddv/pino-aliyun-sls` å¯èƒ½å­˜åœ¨å…¼å®¹æ€§é—®é¢˜
- **Worker Thread é£é™©**: å¯èƒ½å½±å“åº”ç”¨æ€§èƒ½æˆ–ç¨³å®šæ€§
- **é…ç½®å¤æ‚æ€§**: ç¯å¢ƒå˜é‡é…ç½®å¯èƒ½å‡ºé”™

### ç¼“è§£æªæ–½
- å……åˆ†çš„æµ‹è¯•éªŒè¯
- æ¸è¿›å¼éƒ¨ç½²ç­–ç•¥
- å®Œå–„çš„å›æ»šæœºåˆ¶
- è¯¦ç»†çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—

## ğŸ“Š è¿›åº¦è·Ÿè¸ª

| é˜¶æ®µ | çŠ¶æ€ | å¼€å§‹æ—¶é—´ | å®Œæˆæ—¶é—´ | å¤‡æ³¨ |
|------|------|----------|----------|------|
| Phase 1 | â³ å¾…å¼€å§‹ | | | |
| Phase 2 | â³ å¾…å¼€å§‹ | | | |
| Phase 3 | â³ å¾…å¼€å§‹ | | | |
| Phase 4 | â³ å¾…å¼€å§‹ | | | |
| Phase 5 | â³ å¾…å¼€å§‹ | | | |

## ğŸ”„ åç»­è®¡åˆ’

### æˆåŠŸåçš„è¡ŒåŠ¨
1. åˆå¹¶åˆ° `develop/0.7.0-beta` åˆ†æ”¯
2. å‘å¸ƒ `v0.7.0-beta.3` ç‰ˆæœ¬
3. æ›´æ–°é¡¹ç›®æ–‡æ¡£
4. é€šçŸ¥å›¢é˜Ÿæ–°åŠŸèƒ½å¯ç”¨

### å¤±è´¥åçš„å¤‡é€‰æ–¹æ¡ˆ
1. å›é€€åˆ° HTTP ä¸­ç»§æœåŠ¡æ–¹æ¡ˆ
2. è€ƒè™‘å…¶ä»–ç¬¬ä¸‰æ–¹è§£å†³æ–¹æ¡ˆ
3. è”ç³»é˜¿é‡Œäº‘æŠ€æœ¯æ”¯æŒ

---

**è´Ÿè´£äºº**: å¼€å‘å›¢é˜Ÿ  
**å®¡æ ¸äºº**: CTO  
**é¢„è®¡å®Œæˆæ—¶é—´**: 3-4 ä¸ªå·¥ä½œæ—¥
